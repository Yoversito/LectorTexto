// --- Paleta & tokens ---
$brand: #6f3bf5; $brand-600: #5a2de9; $brand-700: #4b22cd;
$accent: #00bfa6; $bg-soft: #f6f7fb; $text-weak: #6b7280; $border: #e5e7eb;
$shadow: 0 10px 30px rgba(17,24,39,.08);
$radius-xl: 1rem; $radius-2xl: 1.25rem; $focus-ring: 0 0 0 3px rgba($brand,.25);

$sm: 576px; $md: 768px; $lg: 992px; $xl: 1200px;

// --- Mixins ---
@mixin smooth { transition: all .2s ease-in-out; }
@mixin card-elevate { box-shadow: $shadow; border: 1px solid $border; border-radius: $radius-2xl; overflow: hidden; }
@mixin range-thumb($size: 18px){ width:$size;height:$size;border-radius:50%;background:linear-gradient(180deg,$brand 0%,$brand-600 100%);border:2px solid #fff;box-shadow:0 2px 4px rgba(0,0,0,.1);cursor:pointer;}
@mixin range-track($h:4px){ height:$h;border-radius:999px;background:linear-gradient(90deg,$brand 0 var(--_fill,0%),#d1d5db var(--_fill,0%) 100%); }

// ========== TEMA CLARO (por defecto) ==========
body {
  padding-block: 16px;
  background:
    radial-gradient(1200px 600px at 10% -10%, rgba($brand,.08) 0%, transparent 50%),
    radial-gradient(1200px 600px at 110% 10%, rgba($accent,.10) 0%, transparent 45%),
    $bg-soft;
  color: #111827;
  @media (min-width:$md){ padding-block:20px } @media(min-width:$lg){ padding-block:24px }
}
.container{ max-width:100%; @media(min-width:$lg){max-width:960px} @media(min-width:$xl){max-width:1080px} }

.card{ @include card-elevate; background:#fff;
  .card-header{ background:linear-gradient(180deg,rgba($brand,.08),rgba($brand,.02)); border-bottom:1px solid $border; padding:.75rem 1rem;
    @media(min-width:$md){padding:.85rem 1.25rem}
    h5{ margin:0; font-weight:700; letter-spacing:.2px; font-size:1rem; display:flex; align-items:center; gap:.5rem;
      @media (min-width:$md){font-size:1.05rem} @media(min-width:$lg){font-size:1.1rem}
      &::after{ content:""; width:6px; height:6px; border-radius:50%; background:$accent; box-shadow:0 0 0 4px rgba($accent,.15); }
    }
  }
  .card-body{ padding:.75rem 1rem; @media(min-width:$md){padding:1rem 1.25rem} @media(min-width:$lg){padding:1.25rem 1.5rem} }
  .card-footer{ border-top:1px solid $border; background:#fafafa; padding:.6rem 1rem; @media(min-width:$md){padding:.75rem 1.25rem} }
}

.form-label{ font-weight:600; margin-bottom:.25rem; font-size:.9rem; } .form-text{ color:$text-weak }

// >>> ÁREA DE TEXTO AUMENTADA Y ESPACIADO OPTIMIZADO <<<
textarea.form-control{
  min-height: 240px; // ↑ Aumentado significativamente
  resize: vertical;
  border-radius:$radius-xl; border:1px solid $border; font-size:.95rem; @include smooth;

  &:hover{ border-color:lighten($brand,25%) }
  &:focus{ border-color:$brand; box-shadow:$focus-ring }

  @media (min-width:$md){ min-height:280px; font-size:1rem }
  @media (min-width:$lg){ min-height:320px }
}

.form-select{ border-radius:$radius-xl; border:1px solid $border; @include smooth;
  &:hover{ border-color:lighten($brand,25%) } &:focus{ border-color:$brand; box-shadow:$focus-ring }
}

// ===== BOTONES CON COLORES CORREGIDOS =====
.card-footer .btn{
  flex:1 1 auto; border-radius:.75rem; padding:.5rem 1rem; font-weight:600; @include smooth;
  & + .btn{ margin-left:.5rem }
  
  // Estados de color específicos
  &.btn-primary{ 
    background:linear-gradient(180deg,$brand 0%,$brand-600 100%); border:none; color:white;
    &:hover{ background:linear-gradient(180deg,$brand-600 0%,$brand-700 100%); transform:translateY(-1px) }
    &:active{ transform:translateY(0) } 
    &:focus-visible{ box-shadow:$focus-ring }
  }
  
  &.btn-warning{ 
    background:linear-gradient(180deg,#ffc107 0%,#e0a800 100%); border:none; color:#212529;
    &:hover{ background:linear-gradient(180deg,#e0a800 0%,#d39e00 100%); transform:translateY(-1px) }
    &:active{ transform:translateY(0) }
    &:focus-visible{ box-shadow:0 0 0 3px rgba(255,193,7,.25) }
  }
  
  &.btn-danger{ 
    background:linear-gradient(180deg,#dc3545 0%,#c82333 100%); border:none; color:white;
    &:hover{ background:linear-gradient(180deg,#c82333 0%,#bd2130 100%); transform:translateY(-1px) }
    &:active{ transform:translateY(0) }
    &:focus-visible{ box-shadow:0 0 0 3px rgba(220,53,69,.25) }
  }
  
  &.btn-outline-secondary{ 
    border:1px solid $border; color:#111827; background:#fff; 
    &:hover{ background:#f3f4f6 } 
    &:focus-visible{ box-shadow:$focus-ring } 
  }
}

.text-muted.small{ color:$text-weak !important; margin-top:.5rem; text-align:center; @media(min-width:$md){ text-align:left } }

// ======== SLIDERS ULTRA COMPACTOS ========
.form-range{
  height:20px; // ← Muy compacto
  padding:4px 0; // ← Mínimo padding
  background:transparent;
  &::-webkit-slider-runnable-track{ @include range-track(4px) } // ← Línea muy fina
  &::-webkit-slider-thumb{ -webkit-appearance:none; margin-top:-4px; @include range-thumb(16px) } // ← Thumb pequeño
  &::-moz-range-track{ @include range-track(4px) } &::-moz-range-thumb{ @include range-thumb(16px) }
  &:hover::-webkit-slider-runnable-track,&:focus::-webkit-slider-runnable-track{ box-shadow:inset 0 0 0 1px rgba($brand,.15) }
  &:hover::-moz-range-track,&:focus::-moz-range-track{ box-shadow:inset 0 0 0 1px rgba($brand,.15) }
}
.range-value{ 
  min-width:2.5rem; text-align:right; padding:.1rem .4rem; border-radius:.4rem; background:#f3f4f6;
  font-variant-numeric:tabular-nums; font-size:.8rem; @media(min-width:$md){font-size:.85rem}
}

// >>> CONTENEDOR DE CONTROLES MUY COMPACTO <<<
.row.g-4 {
  --bs-gutter-y: 0.5rem; // ← Muy reducido
  --bs-gutter-x: 0.75rem;
  
  @media (max-width: $md) {
    --bs-gutter-y: 0.4rem; // ← Aún más compacto en móvil
    --bs-gutter-x: 0.5rem;
  }
}

// >>> MÓVIL: sliders ultra compactos <<<
@media (max-width: $md) {
  .form-range{
    height: 18px;
    padding: 3px 0;
    &::-webkit-slider-runnable-track{ @include range-track(3px) } // ← Línea super fina
    &::-webkit-slider-thumb{ margin-top:-3px; @include range-thumb(14px) }
    &::-moz-range-track{ @include range-track(3px) }
    &::-moz-range-thumb{ @include range-thumb(14px) }
  }
  .form-label{ font-size: .85rem; margin-bottom:.2rem; }
  .range-value{ min-width: 2.2rem; font-size: .75rem; padding:.05rem .3rem; }
}

:focus-visible{ outline:none; box-shadow:$focus-ring !important; border-color:$brand !important; transition: box-shadow .05s }

// ========== TEMA OSCURO (OPT-IN) ==========
.theme-dark{
  body & { background:#0f1115; }
  .card{ background:#13161c; border-color:rgba(255,255,255,.06); }
  .card-header{ background:linear-gradient(180deg, rgba(#fff,.04), rgba(#fff,.01)); border-color:rgba(255,255,255,.06); }
  .card-footer{ background:#0f1217; border-color:rgba(255,255,255,.06); }
  textarea.form-control, .form-select{
    background:#0f1217; color:#e5e7eb; border-color:rgba(255,255,255,.08);
    &::placeholder{ color:rgba(229,231,235,.45) }
  }
  .btn-outline-secondary{ background:#0f1217; color:#e5e7eb; border-color:rgba(255,255,255,.08); &:hover{ background:#151922 } }
  .range-value{ background:rgba(255,255,255,.06); color:#e5e7eb }
  .text-muted.small{ color:rgba(229,231,235,.6) !important }
}

// Micro-animación
.card:hover{ transform:translateY(-1px); box-shadow:0 14px 40px rgba(17,24,39,.10) }

/* ====== Voice Picker (modal custom) ====== */
.voice-select { position: relative; }

/* Contenedor global del modal */
.voice-modal {
  position: fixed; inset: 0; z-index: 1055; display: none;
  &.is-open { display: block; }
}
.voice-modal__overlay {
  position: absolute; inset: 0; background: rgba(17,24,39,.45);
  backdrop-filter: blur(2px);
}

/* Panel centrado y responsivo */
.voice-modal__panel {
  position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
  width: min(640px, 94vw);
  max-height: 85vh;
  display: flex; flex-direction: column;
  background: #fff; border: 1px solid $border; border-radius: 16px; box-shadow: $shadow;

  @media (max-width: $md) {
    width: 94vw;
    border-radius: 14px;
    max-height: 90vh;
  }
}

/* Zonas internas */
.voice-modal__header,
.voice-modal__footer { 
  padding: .85rem 1.25rem;
  border-bottom: 1px solid $border; 
  flex-shrink: 0;
}
.voice-modal__footer { 
  border-bottom: 0; border-top: 1px solid $border; 
  display: flex; gap: .75rem; justify-content: flex-end; 
}
.voice-modal__search { 
  padding: .85rem 1.25rem;
  border-bottom: 1px solid $border; 
  flex-shrink: 0;
}

.voice-modal__list {
  padding: 0.75rem 1.25rem 1rem;
  overflow-y: auto;
  overflow-x: hidden;
  min-height: 200px;
  
  /* Scrollbar personalizada */
  &::-webkit-scrollbar {
    width: 6px;
  }
  &::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
  }
  &::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
    &:hover {
      background: #a8a8a8;
    }
  }
}

/* Items de voz - MEJORADO */
.voice-group-title { 
  font-weight: 700; 
  margin: 1rem 0 0.5rem 0;
  color: #111827; 
  font-size: 0.9rem;
  padding: 0.25rem 0;
  
  &:first-child {
    margin-top: 0.25rem;
  }
}

.voice-item { 
  display: flex; 
  align-items: center; 
  gap: 0.75rem;
  padding: 0.6rem 0.5rem;
  margin: 0.15rem 0;
  border-radius: 0.5rem;
  transition: background-color 0.15s ease;
  cursor: pointer;
  
  &:hover {
    background-color: rgba($brand, 0.04);
  }
  
  /* Radio buttons mejorados */
  .form-check-input {
    margin-top: 0;
    width: 1.1em;
    height: 1.1em;
    flex-shrink: 0;
    
    &:checked {
      background-color: $brand;
      border-color: $brand;
    }
    
    &:focus {
      box-shadow: 0 0 0 0.2rem rgba($brand, 0.25);
    }
  }
  
  .form-check-label {
    flex: 1;
    font-size: 0.85rem;
    line-height: 1.4;
    cursor: pointer;
    padding: 0.1rem 0;
  }
}

/* Dark opt-in */
.theme-dark {
  .voice-modal__panel { 
    background:#13161c; 
    border-color:rgba(255,255,255,.06); 
  }
  .voice-modal__header, 
  .voice-modal__footer, 
  .voice-modal__search { 
    border-color:rgba(255,255,255,.06); 
  }
  .voice-group-title { 
    color:#e5e7eb; 
  }
  .voice-item {
    &:hover {
      background-color: rgba(255,255,255,0.05);
    }
    .form-check-input:checked {
      background-color: $brand;
      border-color: $brand;
    }
  }
  .voice-modal__list {
    &::-webkit-scrollbar-track {
      background: #2d3748;
    }
    &::-webkit-scrollbar-thumb {
      background: #4a5568;
      &:hover {
        background: #718096;
      }
    }
  }
}

/* ===== BARRA DE CONTROLES - ALTURA REDUCIDA Y COLOR AZUL ===== */
.controls-bar{
  display:flex;
  flex-direction:row;
  flex-wrap:nowrap;
  align-items:center;
  gap:.5rem;
}
.controls-bar .btn{
  flex:1 1 0;
  min-width:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0.5rem 0;        // ← Altura muy reducida
  border-radius:.9rem;
  
  /* COLOR AZUL para botones activos/seleccionados */
  &.active {
    &.btn-primary{ 
      background:linear-gradient(180deg,$brand 0%,$brand-600 100%); 
      border:none; 
      color:white;
    }
    &.btn-warning{ 
      background:linear-gradient(180deg,$brand 0%,$brand-600 100%);
      border:none; 
      color:white;
      &:hover{ background:linear-gradient(180deg,$brand-600 0%,$brand-700 100%); }
    }
    &.btn-danger{ 
      background:linear-gradient(180deg,$brand 0%,$brand-600 100%);
      border:none; 
      color:white;
      &:hover{ background:linear-gradient(180deg,$brand-600 0%,$brand-700 100%); }
    }
  }
  
  /* Estados hover para botones activos */
  &.active:hover {
    transform:translateY(-1px);
  }
}

/* Anula el apilado en móvil SOLO dentro de la barra de controles */
@media (max-width:$sm){
  .card-footer.controls-bar .btn{
    display:flex !important;
    width:auto !important;
    margin-top:0 !important;
  }
  .card-footer.controls-bar .btn + .btn{
    margin-left:.5rem !important;
  }
  
  /* Ajustes específicos para móvil en el modal */
  .voice-modal__panel {
    max-height: 88vh;
  }
  .voice-item {
    padding: 0.75rem 0.5rem;
  }
  
  /* Altura aún más reducida en móvil para botones */
  .controls-bar .btn {
    padding: 0.4rem 0;          // ← Ultra compacto en móvil
  }
}